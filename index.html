<!doctype html>
<html lang="en">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
Â  <title>Happy Birthday â€” A Little World For You</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700;800&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

Â  <style>
Â  Â  :root{
Â  Â  Â  --bg-dark: #0c0a09;
Â  Â  Â  --muted: #e6e6e6;
Â  Â  Â  --accent-start: #ff7aa2;
Â  Â  Â  --accent-end: #ff3b6b;
Â  Â  Â  --glass-border: rgba(255,255,255,0.06);
Â  Â  }
Â  Â  html,body{height:100%;margin:0;background:var(--bg-dark);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:var(--muted);-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;overflow:hidden;}
Â  Â  /* Aurora background */
Â  Â  .aurora{position:fixed;inset:0;z-index:0;pointer-events:none;
Â  Â  Â  background:
Â  Â  Â  Â  radial-gradient(600px 300px at 10% 20%, hsla(333,70%,55%,.35), transparent 20%),
Â  Â  Â  Â  radial-gradient(500px 250px at 80% 30%, hsla(282,82%,54%,.25), transparent 20%),
Â  Â  Â  Â  radial-gradient(600px 300px at 40% 80%, hsla(210,89%,60%,.25), transparent 20%),
Â  Â  Â  Â  radial-gradient(700px 350px at 60% 50%, hsla(35,90%,60%,.2), transparent 18%),
Â  Â  Â  Â  var(--bg-dark);
Â  Â  Â  filter: blur(34px) contrast(1.03) saturate(1.06);
Â  Â  Â  animation: auroraFlow 20s ease-in-out infinite;
Â  Â  Â  mix-blend-mode:screen; opacity:0.95;
Â  Â  }
Â  Â  @keyframes auroraFlow {0%{background-position:0% 0%,0% 0%,0% 0%,0% 0%}50%{background-position:8% 12%,-6% 22%,4% -8%,-4% 6%}100%{background-position:0% 0%,0% 0%,0% 0%,0% 0%}}
Â  Â  /* three.js canvas */
Â  Â  #three-bg{position:fixed;inset:0;z-index:1;pointer-events:none}
Â  Â  /* stage centers steps */
Â  Â  #stage{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:5;pointer-events:none}
Â  Â  /* steps root */
Â  Â  #steps-root{position:relative; width:min(920px,94vw); height:min(740px,86vh); pointer-events:auto}
Â  Â  /* cards (steps) absolutely centered inside steps-root */
Â  Â  .card.step{
Â  Â  Â  position:absolute; inset:0; margin:auto; width:100%; max-width:920px; max-height:calc(86vh - 40px); display:flex; align-items:center; justify-content:flex-start; gap:24px;
Â  Â  Â  box-sizing:border-box; padding:32px; border-radius:16px;
Â  Â  Â  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
Â  Â  Â  border:1px solid var(--glass-border); backdrop-filter: blur(12px) saturate(120%); -webkit-backdrop-filter: blur(12px) saturate(120%);
Â  Â  Â  box-shadow: 0 18px 50px rgba(0,0,0,0.55); overflow:visible; pointer-events:none;
Â  Â  Â  opacity:0; transform: translateY(18px) scale(0.99);
Â  Â  }
Â  Â  .card.step.active{opacity:1; transform:translateY(0) scale(1); pointer-events:auto;}
Â  Â  .card-inner{flex:1 1 auto}
Â  Â  .icon{width:110px;height:110px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-size:44px;flex-shrink:0}
Â  Â  h1,h2{font-family:"Playfair Display",serif;margin:0;color:transparent;background-clip:text;-webkit-background-clip:text;background-image:linear-gradient(90deg,#ffd6ea 10%, #fff 40%, #ffb3c9 70%);font-weight:700}
Â  Â  h1{font-size:clamp(28px,4.6vw,44px); line-height:1.02}
Â  Â  h2{font-size:clamp(20px,2.6vw,28px)}
Â  Â  p{font-family:Inter,system-ui; margin:12px 0 0 0; color:rgba(255,255,255,0.92); font-size:clamp(14px,1.6vw,16px); line-height:1.45}
Â  Â  .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 18px;border-radius:999px;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));color:white;font-weight:700;border:none;cursor:pointer;box-shadow:0 10px 30px rgba(255,80,140,0.12); transform-origin:center; transition:transform .18s, box-shadow .18s; user-select:none}
Â  Â  .btn:hover{transform:translateY(-6px) scale(1.05); box-shadow:0 18px 48px rgba(255,80,140,0.22)}
Â  Â  .btn:active{transform:translateY(2px) scale(.99)}
Â  Â  .pulse{animation:pulse 1.6s ease-in-out infinite}
Â  Â  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
Â  Â  /* Bento */
Â  Â  .bento{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px}
Â  Â  .bento .item{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);min-height:84px}
Â  Â  .bento .big{grid-column:span 2; min-height:120px}
Â  Â  .bento h3{font-family:"Playfair Display",serif;margin:0;color:transparent;background-clip:text;-webkit-background-clip:text;background-image:linear-gradient(90deg,#ffd6ea,#fff,#ffc1da)}
Â  Â  .bento p{margin:0}
Â  Â  /* polaroid */
Â  Â  .polaroid{width:320px; max-width:44vw; background:#fff; padding:12px;border-radius:10px; box-shadow:0 14px 38px rgba(0,0,0,0.55); transform-style:preserve-3d; transition:transform .28s}
Â  Â  .polaroid img{width:100%;display:block;border-radius:6px}
Â  Â  .caption{margin-top:10px;font-size:13px;color:#303030;text-align:center}
Â  Â  /* final wish */
Â  Â  .final-wish{font-family:"Playfair Display", serif; font-size:clamp(26px,4.4vw,40px); margin-top:14px; color:transparent; background-clip:text; -webkit-background-clip:text; background-image: linear-gradient(90deg,#fff9f2,#ffd6ea 60%, #ffb3c9 100%); text-align:center; opacity:0; transform:translateY(12px)}
Â  Â  /* progress */
Â  Â  .progress-wrap{position:fixed; top:18px; left:50%; transform:translateX(-50%); z-index:12; width:min(780px,92vw); height:10px; border-radius:999px; background:rgba(255,255,255,0.035); padding:2px; display:flex; align-items:center; box-shadow:0 6px 18px rgba(0,0,0,0.45); backdrop-filter:blur(6px)}
Â  Â  .progress{height:100%; width:0%; border-radius:999px; background:linear-gradient(90deg,var(--accent-start),var(--accent-end)); transition:width .7s cubic-bezier(.2,.9,.2,1)}
Â  Â  /* audio UI */
Â  Â  .audio-toggle{position:fixed; right:18px; bottom:18px; z-index:60; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.06); padding:10px; border-radius:999px; box-shadow:0 10px 30px rgba(0,0,0,0.45); display:flex; gap:8px; align-items:center; backdrop-filter:blur(6px)}
Â  Â  .audio-toggle button{background:transparent;border:none;color:var(--muted);font-size:18px;cursor:pointer}
Â  Â  .audio-toggle input[type="range"]{width:90px}
Â  Â  /* responsiveness */
Â  Â  @media (max-width:900px){
Â  Â  Â  #steps-root{height:auto; padding:18px}
Â  Â  Â  .card.step{flex-direction:column; align-items:flex-start; padding:20px; gap:16px; max-height:82vh; overflow:auto}
Â  Â  Â  .icon{width:86px;height:86px;font-size:36px;border-radius:12px}
Â  Â  Â  .polaroid{width:88%}
Â  Â  Â  .bento{grid-template-columns:repeat(2,1fr)}
Â  Â  Â  .bento .big{grid-column:span 2}
Â  Â  Â  .progress-wrap{top:12px;height:9px}
Â  Â  }
Â  Â  @media (max-width:480px){
Â  Â  Â  body,html{overflow:hidden}
Â  Â  }
Â  </style>
</head>
<body>
Â  Â  <div class="aurora" aria-hidden="true"></div>
Â  <div id="three-bg" aria-hidden="true"></div>

Â  Â  <div class="progress-wrap" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
Â  Â  <div id="progressBar" class="progress"></div>
Â  </div>

Â  Â  <div id="stage">
Â  Â  <div id="steps-root" aria-live="polite">
Â  Â  Â  Â  Â  Â  <div class="card step active" id="step-1" data-step="1">
Â  Â  Â  Â  <div class="icon" aria-hidden="true"><div class="pulse" style="font-size:46px">â¤ï¸</div></div>
Â  Â  Â  Â  <div class="card-inner">
Â  Â  Â  Â  Â  <h1>Hey Beautiful,</h1>
Â  Â  Â  Â  Â  <p>I built a little world for you, just to bring a smile to your face on your special day.</p>
Â  Â  Â  Â  Â  <div style="margin-top:18px">
Â  Â  Â  Â  Â  Â  <button class="btn" data-next>Let's Begin</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card step" id="step-2" data-step="2">
Â  Â  Â  Â  <div class="icon" aria-hidden="true"><div style="font-size:42px">ğŸ‰</div></div>
Â  Â  Â  Â  <div class="card-inner">
Â  Â  Â  Â  Â  <h2>Happy Birthday!</h2>
Â  Â  Â  Â  Â  <p>Another year of you making the world brighter. Your existence is a gift, and I'm so lucky to witness it.</p>
Â  Â  Â  Â  Â  <div style="margin-top:18px">
Â  Â  Â  Â  Â  Â  <button class="btn" data-next>There's more...</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card step" id="step-3" data-step="3">
Â  Â  Â  Â  <div style="width:160px; flex-shrink:0;">
Â  Â  Â  Â  Â  <div class="icon" style="height:160px;width:160px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px">ğŸ’–</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-inner">
Â  Â  Â  Â  Â  <h2>A Few Things I Adore About You</h2>
Â  Â  Â  Â  Â  <div class="bento">
Â  Â  Â  Â  Â  Â  <div class="item big"><h3>âœ¨ Your Unmatched Kindness</h3><p>The genuine warmth you show to everyone is something truly rare and beautiful.</p></div>
Â  Â  Â  Â  Â  Â  <div class="item"><h3>ğŸ˜Š That Smile</h3><p>It's a work of art.</p></div>
Â  Â  Â  Â  Â  Â  <div class="item big"><h3>ğŸŒŸ Your Radiant Spirit</h3><p>Your passion for life is infectious. Being around you makes everything feel more exciting and possible.</p></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="margin-top:16px"><button class="btn" data-next>Remember this?</button></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card step" id="step-4" data-step="4">
Â  Â  Â  Â  <div style="width:340px;display:flex;align-items:center;justify-content:center">
Â  Â  Â  Â  Â  <div class="polaroid" id="polaroid" style="cursor:grab">
Â  Â  Â  Â  Â  Â  <img src="https://i.ibb.co/6Z6XgCg/crush.webp" alt="Our memory" />
Â  Â  Â  Â  Â  Â  <div class="caption">Our favorite memory.</div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-inner">
Â  Â  Â  Â  Â  <h2>That One Time...</h2>
Â  Â  Â  Â  Â  <p>Every moment with you feels like a scene from a movie I'd watch on repeat.</p>
Â  Â  Â  Â  Â  <div style="margin-top:18px"><button class="btn" data-next>One last thing...</button></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card step" id="step-5" data-step="5">
Â  Â  Â  Â  <div class="icon" style="height:110px;width:110px;border-radius:16px"><div style="font-size:42px">ğŸ‚</div></div>
Â  Â  Â  Â  <div class="card-inner">
Â  Â  Â  Â  Â  <h2>My Wish For You</h2>
Â  Â  Â  Â  Â  <p>May the next year bring you all the love, success, and pure happiness you so rightfully deserve. May your dreams soar higher than ever.</p>
Â  Â  Â  Â  Â  <div style="margin-top:18px; display:flex; gap:14px; align-items:center">
Â  Â  Â  Â  Â  Â  <button class="btn" id="celebrateBtn">Celebrate!</button>
Â  Â  Â  Â  Â  Â  <div style="flex:1"></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="final-wish" id="finalWish">Happy Birthday, my crush! â¤ï¸</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  Â  <canvas id="confetti-canvas" style="position:fixed;pointer-events:none;inset:0;z-index:50"></canvas>

Â  Â  <div class="audio-toggle" id="audioToggle" aria-hidden="false">
Â  Â  <button id="audioBtn" title="Toggle music">ğŸ”ˆ</button>
Â  Â  <input id="volRange" type="range" min="0" max="1" step="0.01" value="0.65" />
Â  </div>

Â  <script>
Â  Â  /***********************
Â  Â  Â * Utilities & State
Â  Â  Â ***********************/
Â  Â  const steps = Array.from(document.querySelectorAll('.card.step'));
Â  Â  let currentStep = 0;
Â  Â  const totalSteps = steps.length;
Â  Â  const progressBar = document.getElementById('progressBar');

Â  Â  // Step 1 is active from the start, no need to touch classes here.

Â  Â  function updateProgress(){
Â  Â  Â  const pct = Math.round((currentStep / (totalSteps - 1)) * 100);
Â  Â  Â  progressBar.style.width = pct + '%';
Â  Â  Â  document.querySelector('.progress-wrap').setAttribute('aria-valuenow', pct);
Â  Â  }

Â  Â  /***********************
Â  Â  Â * Show step (centered, no scroll)
Â  Â  Â ***********************/
Â  Â  function showStep(index){
Â  Â  Â  if(index < 0) index = 0;
Â  Â  Â  if(index >= totalSteps) index = totalSteps - 1;

Â  Â  Â  const prev = steps[currentStep];
Â  Â  Â  const next = steps[index];
Â  Â  Â  if(prev && prev !== next){
Â  Â  Â  Â  gsap.to(prev, {duration:0.45, opacity:0, scale:0.98, y:10, ease:'power3.inOut', pointerEvents:'none', onComplete:()=> { prev.classList.remove('active'); }});
Â  Â  Â  }
Â  Â  Â  // ensure snap to top as fail-safe if layout shifted
Â  Â  Â  try { window.scrollTo({ top: 0, behavior: 'smooth' }); } catch(e){ /* ignore */ }

Â  Â  Â  // animate in next
Â  Â  Â  next.classList.add('active');
Â  Â  Â  gsap.fromTo(next, {opacity:0, y:18, scale:0.99}, {duration:0.6, opacity:1, y:0, scale:1, ease:'power3.out', onStart:()=>{
Â  Â  Â  Â  // stagger inner elements
Â  Â  Â  Â  const innerEls = next.querySelectorAll('h1,h2,p,.btn,.bento .item,.polaroid');
Â  Â  Â  Â  if(innerEls.length) gsap.from(innerEls, {duration:0.6, y:8, opacity:0, stagger:0.06, ease:'power3.out'});
Â  Â  Â  }});
Â  Â  Â  currentStep = index;
Â  Â  Â  updateProgress();
Â  Â  }

Â  Â  updateProgress(); // Initial progress set

Â  Â  /***********************
Â  Â  Â * Polaroid tilt/parallax (touch-friendly)
Â  Â  Â ***********************/
Â  Â  (function(){
Â  Â  Â  const polaroid = document.getElementById('polaroid');
Â  Â  Â  if(!polaroid) return;
Â  Â  Â  let rect = polaroid.getBoundingClientRect();
Â  Â  Â  function onMove(e){
Â  Â  Â  Â  const cx = e.clientX || (e.touches && e.touches[0].clientX);
Â  Â  Â  Â  const cy = e.clientY || (e.touches && e.touches[0].clientY);
Â  Â  Â  Â  if(!cx || !cy) return;
Â  Â  Â  Â  const x = cx - (rect.left + rect.width/2);
Â  Â  Â  Â  const y = cy - (rect.top + rect.height/2);
Â  Â  Â  Â  const rx = (-y / rect.height) * 8;
Â  Â  Â  Â  const ry = (x / rect.width) * 8;
Â  Â  Â  Â  gsap.to(polaroid, {duration:0.35, rotationX: rx, rotationY: ry, ease:'power3.out', transformOrigin:'center center'});
Â  Â  Â  }
Â  Â  Â  function enter(){ rect = polaroid.getBoundingClientRect(); document.addEventListener('mousemove', onMove); document.addEventListener('touchmove', onMove, {passive:true}); }
Â  Â  Â  function leave(){ document.removeEventListener('mousemove', onMove); gsap.to(polaroid, {duration:0.6, rotationX:0, rotationY:0, ease:'elastic.out(1,0.6)'}); }
Â  Â  Â  polaroid.addEventListener('mouseenter', enter);
Â  Â  Â  polaroid.addEventListener('mouseleave', leave);
Â  Â  Â  polaroid.addEventListener('touchstart', enter, {passive:true});
Â  Â  Â  polaroid.addEventListener('touchend', leave);
Â  Â  })();

Â  Â  /***********************
Â  Â  Â * CONFETTI (finale)
Â  Â  Â ***********************/
Â  Â  function launchConfettiSequence(){
Â  Â  Â  const myConfetti = confetti.create(document.getElementById('confetti-canvas'), { resize: true, useWorker: true });

Â  Â  Â  myConfetti({ particleCount: 40, angle: 60, spread: 48, origin: { x: 0.02, y: 0.9 }, scalar: 1.2 });
Â  Â  Â  myConfetti({ particleCount: 40, angle: 120, spread: 48, origin: { x: 0.98, y: 0.9 }, scalar: 1.2 });

Â  Â  Â  setTimeout(()=> myConfetti({ particleCount: 36, angle: 90, spread: 100, origin: {x:0.5, y:0.9}}), 220);
Â  Â  Â  setTimeout(()=> myConfetti({ particleCount: 48, angle: 80, spread: 140, origin: {x:0.3, y:0.9}}), 340);
Â  Â  Â  setTimeout(()=> myConfetti({ particleCount: 48, angle: 100, spread: 140, origin: {x:0.7, y:0.9}}), 360);

Â  Â  Â  const duration = 5000;
Â  Â  Â  const end = Date.now() + duration;
Â  Â  Â  (function frame(){
Â  Â  Â  Â  myConfetti({ particleCount: 6, angle: 90, spread: 80, origin: { x: Math.random(), y: 0.0 }, shapes: ['square','circle'], scalar: 0.9 + Math.random() * 0.6 });
Â  Â  Â  Â  if (Math.random() < 0.12) {
Â  Â  Â  Â  Â  myConfetti({ particleCount: 8, angle: 90 + (Math.random()*40-20), spread: 40, origin: { x: Math.random(), y: 0.0 }, scalar: 1.4 + Math.random() });
Â  Â  Â  Â  }
Â  Â  Â  Â  if (Date.now() < end) requestAnimationFrame(frame);
Â  Â  Â  })();
Â  Â  }

Â  Â  /***********************
Â  Â  Â * THREE.JS Hearts (optimized mobile-friendly)
Â  Â  Â ***********************/
Â  Â  const threeContainer = document.getElementById('three-bg');
Â  Â  const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
Â  Â  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
Â  Â  renderer.setSize(window.innerWidth, window.innerHeight);
Â  Â  renderer.domElement.style.width = '100%';
Â  Â  renderer.domElement.style.height = '100%';
Â  Â  threeContainer.appendChild(renderer.domElement);

Â  Â  const scene = new THREE.Scene();
Â  Â  const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 2000);
Â  Â  camera.position.set(0,0,60);

Â  Â  const ambient = new THREE.AmbientLight(0xffffff, 0.6);
Â  Â  scene.add(ambient);
Â  Â  const dir = new THREE.DirectionalLight(0xffffff, 0.6); dir.position.set(50,50,100); scene.add(dir);
Â  Â  const hemi = new THREE.HemisphereLight(0xffffff, 0x111114, 0.09); scene.add(hemi);

Â  Â  function createHeartShape(scale=1){
Â  Â  Â  const heart = new THREE.Shape();
Â  Â  Â  const x=0,y=0;
Â  Â  Â  heart.moveTo(x, y + 8 * scale);
Â  Â  Â  heart.bezierCurveTo(x + 8 * scale, y + 20 * scale, x + 34 * scale, y + 20 * scale, x + 34 * scale, y + 8 * scale);
Â  Â  Â  heart.bezierCurveTo(x + 34 * scale, y - 6 * scale, x + 16 * scale, y - 6 * scale, x + 12 * scale, y + 6 * scale);
Â  Â  Â  heart.bezierCurveTo(x + 8 * scale, y - 6 * scale, x - 14 * scale, y - 6 * scale, x - 14 * scale, y + 6 * scale);
Â  Â  Â  heart.bezierCurveTo(x - 18 * scale, y - 6 * scale, x - 34 * scale, y - 6 * scale, x - 34 * scale, y + 8 * scale);
Â  Â  Â  heart.bezierCurveTo(x - 34 * scale, y + 20 * scale, x - 8 * scale, y + 20 * scale, x, y + 8 * scale);
Â  Â  Â  return heart;
Â  Â  }
Â  Â  function createHeartMaterial(hex){
Â  Â  Â  return new THREE.MeshStandardMaterial({ color:hex, metalness:0.08, roughness:0.28, emissive: new THREE.Color(hex).multiplyScalar(0.05), side:THREE.DoubleSide });
Â  Â  }

Â  Â  const heartsGroup = new THREE.Group(); scene.add(heartsGroup);
Â  Â  const heartMeshes = [];
Â  Â  // adjust heart count for mobile
Â  Â  const isMobile = window.matchMedia("(max-width:900px)").matches;
Â  Â  const numHearts = isMobile ? 12 : 22;
Â  Â  const colors = ['#ff7aa2','#ff4f7a','#ff9cb1','#ff2b6f','#ff6b98'];

Â  Â  for(let i=0;i<numHearts;i++){
Â  Â  Â  const shape = createHeartShape(0.8);
Â  Â  Â  const extrudeSettings = { depth: 2 + Math.random()*3, bevelEnabled:true, bevelThickness:0.8, bevelSize:0.8, bevelSegments:4 };
Â  Â  Â  const geom = new THREE.ExtrudeGeometry(shape, extrudeSettings);
Â  Â  Â  geom.computeBoundingBox(); geom.center();
Â  Â  Â  const mat = createHeartMaterial(colors[Math.floor(Math.random()*colors.length)]);
Â  Â  Â  const mesh = new THREE.Mesh(geom, mat);
Â  Â  Â  mesh.position.x = (Math.random()-0.5) * 120;
Â  Â  Â  mesh.position.y = (Math.random()-0.5) * 80;
Â  Â  Â  mesh.position.z = -20 + Math.random() * 80;
Â  Â  Â  const scale = (Math.random()*0.7)+0.6;
Â  Â  Â  mesh.scale.setScalar(scale * (0.6 + Math.random()*0.8));
Â  Â  Â  mesh.rotation.set(Math.random()*Math.PI, Math.random()*Math.PI, Math.random()*Math.PI * 0.2);
Â  Â  Â  mesh.userData = { baseY: mesh.position.y, speed: 0.2 + Math.random()*0.7, sway: 0.2 + Math.random()*0.9, rotSpeed: (Math.random()-0.5)*0.002 };
Â  Â  Â  heartsGroup.add(mesh); heartMeshes.push(mesh);
Â  Â  }

Â  Â  window.addEventListener('resize', onResize);
Â  Â  function onResize(){ renderer.setSize(window.innerWidth, window.innerHeight); camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); }

Â  Â  let swirlOut=false, swirlStart=null;
Â  Â  function animate(t){
Â  Â  Â  const time = t * 0.001;
Â  Â  Â  heartMeshes.forEach((m,i)=>{
Â  Â  Â  Â  const ud = m.userData;
Â  Â  Â  Â  const sway = Math.sin(time * ud.speed + i) * ud.sway * 4.5;
Â  Â  Â  Â  m.position.x += Math.sin(time * ud.speed * 0.8 + i) * 0.02;
Â  Â  Â  Â  m.position.y = ud.baseY + sway;
Â  Â  Â  Â  m.rotation.x += ud.rotSpeed * 6;
Â  Â  Â  Â  m.rotation.y += ud.rotSpeed * 3;
Â  Â  Â  });

Â  Â  Â  if(swirlOut){
Â  Â  Â  Â  if(!swirlStart) swirlStart = time;
Â  Â  Â  Â  const progress = Math.min((time - swirlStart) / 3.0, 1.0);
Â  Â  Â  Â  heartMeshes.forEach((m,i)=>{
Â  Â  Â  Â  Â  const dirX = (m.position.x) >= 0 ? 1 : -1;
Â  Â  Â  Â  Â  m.position.x += dirX * 0.6 * (1 + progress*2);
Â  Â  Â  Â  Â  m.position.y += 0.8 + Math.sin(time + i) * 0.6 + progress*3;
Â  Â  Â  Â  Â  m.position.z += 0.6 + progress*2;
Â  Â  Â  Â  Â  m.material.opacity = Math.max(0, 1 - progress);
Â  Â  Â  Â  Â  m.material.transparent = true;
Â  Â  Â  Â  });
Â  Â  Â  Â  ambient.intensity = Math.max(0.2, 0.6 * (1 - progress));
Â  Â  Â  }
Â  Â  Â  renderer.render(scene, camera);
Â  Â  Â  requestAnimationFrame(animate);
Â  Â  }
Â  Â  requestAnimationFrame(animate);
Â  Â  function heartsSwirlOut(){ swirlOut = true; gsap.to(camera.position, {duration:2.2, z:95, ease:'power2.out'}); }

Â  Â  /***********************
Â  Â  Â * AUDIO: WebAudio-based lo-fi pad + clicks/chimes
Â  Â  Â ***********************/
Â  Â  const AudioManager = (function(){
Â  Â  Â  let ctx = null, master=null, musicGain=null, isInit=false, isPlaying=false, ambientNodes=[], pulseInterval=null;
Â  Â  Â  function safeTry(fn){ try{ fn(); } catch(e){ console.warn('Audio err', e); } }
Â  Â  Â  function init(){
Â  Â  Â  Â  if(isInit) return;
Â  Â  Â  Â  try{ ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e){ console.warn('WebAudio not supported'); return; }
Â  Â  Â  Â  master = ctx.createGain(); master.gain.value = parseFloat(document.getElementById('volRange').value || 0.65); master.connect(ctx.destination);
Â  Â  Â  Â  musicGain = ctx.createGain(); musicGain.gain.value = 0; musicGain.connect(master);
Â  Â  Â  Â  // two detuned oscillators as warm pad
Â  Â  Â  Â  const oscA = ctx.createOscillator(); const oscB = ctx.createOscillator();
Â  Â  Â  Â  oscA.type='sine'; oscB.type='sine'; oscA.frequency.value = 110; oscB.frequency.value = 110 * 1.012;
Â  Â  Â  Â  const oscAGain = ctx.createGain(); oscAGain.gain.value=0.16; const oscBGain = ctx.createGain(); oscBGain.gain.value=0.12;
Â  Â  Â  Â  const lfo = ctx.createOscillator(); lfo.type='sine'; lfo.frequency.value=0.055; const lfoGain = ctx.createGain(); lfoGain.gain.value=0.04;
Â  Â  Â  Â  const lp = ctx.createBiquadFilter(); lp.type='lowpass'; lp.frequency.value = 1200;
Â  Â  Â  Â  const detuneOsc = ctx.createOscillator(); detuneOsc.type='sine'; detuneOsc.frequency.value=0.08; const detuneGain = ctx.createGain(); detuneGain.gain.value=4;
Â  Â  Â  Â  oscA.connect(oscAGain); oscB.connect(oscBGain); oscAGain.connect(lp); oscBGain.connect(lp); lp.connect(musicGain);
Â  Â  Â  Â  lfo.connect(lfoGain); lfoGain.connect(oscAGain.gain); lfoGain.connect(oscBGain.gain);
Â  Â  Â  Â  detuneOsc.connect(detuneGain); detuneGain.connect(oscA.detune); detuneGain.connect(oscB.detune);
Â  Â  Â  Â  // noise texture
Â  Â  Â  Â  const noiseBuffer = ctx.createBuffer(1, ctx.sampleRate * 3, ctx.sampleRate);
Â  Â  Â  Â  const data = noiseBuffer.getChannelData(0); for(let i=0;i<data.length;i++) data[i] = (Math.random()*2-1) * 0.25;
Â  Â  Â  Â  const nb = ctx.createBufferSource(); nb.buffer = noiseBuffer; nb.loop = true;
Â  Â  Â  Â  const noiseFilter = ctx.createBiquadFilter(); noiseFilter.type='lowpass'; noiseFilter.frequency.value = 900;
Â  Â  Â  Â  const noiseGain = ctx.createGain(); noiseGain.gain.value = 0.04;
Â  Â  Â  Â  nb.connect(noiseFilter); noiseFilter.connect(noiseGain); noiseGain.connect(musicGain);
Â  Â  Â  Â  // percussive pulse oscillator
Â  Â  Â  Â  const pulseGain = ctx.createGain(); pulseGain.gain.value = 0;
Â  Â  Â  Â  const pulseOsc = ctx.createOscillator(); pulseOsc.type = 'triangle'; pulseOsc.frequency.value = 220;
Â  Â  Â  Â  pulseOsc.connect(pulseGain); pulseGain.connect(musicGain);

Â  Â  Â  Â  safeTry(()=>{ oscA.start(); oscB.start(); lfo.start(); detuneOsc.start(); nb.start(); pulseOsc.start(); });

Â  Â  Â  Â  ambientNodes.push({oscA, oscB, lfo, detuneOsc, nb, noiseGain, pulseGain, pulseOsc, lp});
Â  Â  Â  Â  isInit = true;
Â  Â  Â  }
Â  Â  Â  function resumeIfNeeded(){ if(!ctx) return Promise.resolve(); if(ctx.state === 'suspended') return ctx.resume().catch(()=>{}); return Promise.resolve(); }
Â  Â  Â  function playBackground(){
Â  Â  Â  Â  if(!isInit) init();
Â  Â  Â  Â  if(!ctx) return;
Â  Â  Â  Â  return resumeIfNeeded().then(()=> {
Â  Â  Â  Â  Â  isPlaying = true;
Â  Â  Â  Â  Â  safeTry(()=> gsap.to(musicGain.gain, {value:0.55, duration:2.2, ease:'sine.inOut'}));
Â  Â  Â  Â  Â  schedulePulse();
Â  Â  Â  Â  }).catch(()=>{});
Â  Â  Â  }
Â  Â  Â  function schedulePulse(){
Â  Â  Â  Â  if(pulseInterval) clearInterval(pulseInterval);
Â  Â  Â  Â  pulseInterval = setInterval(()=> {
Â  Â  Â  Â  Â  if(!isPlaying) return;
Â  Â  Â  Â  Â  const n = ambientNodes[0]; if(!n) return;
Â  Â  Â  Â  Â  const g = n.pulseGain.gain;
Â  Â  Â  Â  Â  try{ g.cancelScheduledValues(ctx.currentTime); g.setValueAtTime(0, ctx.currentTime); g.linearRampToValueAtTime(0.15, ctx.currentTime+0.03); g.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 1.1); }catch(e){}
Â  Â  Â  Â  }, 3600 + Math.random()*1800);
Â  Â  Â  }
Â  Â  Â  function stopBackground(){
Â  Â  Â  Â  if(!isInit) return;
Â  Â  Â  Â  try{ gsap.to(musicGain.gain, {value:0, duration:1.2, ease:'sine.inOut', onComplete:()=>{ isPlaying=false; if(pulseInterval) clearInterval(pulseInterval); } }); }catch(e){ isPlaying=false; if(pulseInterval) clearInterval(pulseInterval); }
Â  Â  Â  }
Â  Â  Â  function playClick(){
Â  Â  Â  Â  if(!isInit) init();
Â  Â  Â  Â  if(!ctx) return;
Â  Â  Â  Â  return resumeIfNeeded().then(()=> {
Â  Â  Â  Â  Â  const now = ctx.currentTime;
Â  Â  Â  Â  Â  const b = ctx.createBufferSource();
Â  Â  Â  Â  Â  const buffer = ctx.createBuffer(1, ctx.sampleRate * 0.06, ctx.sampleRate);
Â  Â  Â  Â  Â  const d = buffer.getChannelData(0);
Â  Â  Â  Â  Â  for(let i=0;i<d.length;i++) d[i] = (Math.random()*2-1) * Math.exp(-i/(d.length*0.4));
Â  Â  Â  Â  Â  b.buffer = buffer;
Â  Â  Â  Â  Â  const bp = ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value = 1700 + Math.random()*300;
Â  Â  Â  Â  Â  const g = ctx.createGain(); g.gain.value = 0.4;
Â  Â  Â  Â  Â  b.connect(bp); bp.connect(g); g.connect(master);
Â  Â  Â  Â  Â  b.start(now);
Â  Â  Â  Â  Â  g.gain.setValueAtTime(0.4, now);
Â  Â  Â  Â  Â  g.gain.exponentialRampToValueAtTime(0.001, now + 0.38);
Â  Â  Â  Â  Â  setTimeout(()=>{ try{ b.disconnect(); bp.disconnect(); g.disconnect(); }catch(e){} }, 900);
Â  Â  Â  Â  }).catch(()=>{});
Â  Â  Â  }
Â  Â  Â  function playChime(){
Â  Â  Â  Â  if(!isInit) init();
Â  Â  Â  Â  if(!ctx) return;
Â  Â  Â  Â  return resumeIfNeeded().then(()=>{
Â  Â  Â  Â  Â  const now = ctx.currentTime; const freqs=[880,1320,1760];
Â  Â  Â  Â  Â  freqs.forEach((f,i)=>{
Â  Â  Â  Â  Â  Â  const o = ctx.createOscillator(); o.type='sine'; o.frequency.value=f;
Â  Â  Â  Â  Â  Â  const g = ctx.createGain(); g.gain.value=0;
Â  Â  Â  Â  Â  Â  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value = 7200 - i*800;
Â  Â  Â  Â  Â  Â  o.connect(filter); filter.connect(g); g.connect(master);
Â  Â  Â  Â  Â  Â  o.start(now + i*0.02);
Â  Â  Â  Â  Â  Â  g.gain.setValueAtTime(0.0001, now);
Â  Â  Â  Â  Â  Â  g.gain.exponentialRampToValueAtTime(0.12/(i+1), now + 0.02 + i*0.01);
Â  Â  Â  Â  Â  Â  g.gain.exponentialRampToValueAtTime(0.0001, now + 1.6 + i*0.05);
Â  Â  Â  Â  Â  Â  o.stop(now + 2.0 + i*0.05);
Â  Â  Â  Â  Â  Â  setTimeout(()=>{ try{ o.disconnect(); g.disconnect(); filter.disconnect(); }catch(e){} }, 2600);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }).catch(()=>{});
Â  Â  Â  }
Â  Â  Â  function playCelebration(){
Â  Â  Â  Â  if(!isInit) init();
Â  Â  Â  Â  if(!ctx) return;
Â  Â  Â  Â  return resumeIfNeeded().then(()=>{
Â  Â  Â  Â  Â  const now = ctx.currentTime; const base=[1320,1100,880,660];
Â  Â  Â  Â  Â  base.forEach((f, idx)=>{ for(let j=0;j<3;j++){
Â  Â  Â  Â  Â  Â  const o = ctx.createOscillator(); o.type='sine'; o.frequency.value = f * (1 + (Math.random()-0.5)*0.02);
Â  Â  Â  Â  Â  Â  const g = ctx.createGain(); g.gain.value=0;
Â  Â  Â  Â  Â  Â  const filter = ctx.createBiquadFilter(); filter.type='lowpass'; filter.frequency.value=7200;
Â  Â  Â  Â  Â  Â  o.connect(filter); filter.connect(g); g.connect(master);
Â  Â  Â  Â  Â  Â  const start = now + idx*0.12 + j*0.03; o.start(start);
Â  Â  Â  Â  Â  Â  g.gain.setValueAtTime(0.0001,start); g.gain.exponentialRampToValueAtTime(0.18/(j+1), start+0.02); g.gain.exponentialRampToValueAtTime(0.0001, start + 1.2 + Math.random()*0.8);
Â  Â  Â  Â  Â  Â  o.stop(start + 2.4 + Math.random()*0.7);
Â  Â  Â  Â  Â  }});
Â  Â  Â  Â  Â  setTimeout(()=> playChime(), 160); setTimeout(()=> playChime(), 420);
Â  Â  Â  Â  }).catch(()=>{});
Â  Â  Â  }
Â  Â  Â  function setVolume(v){ if(master && ctx) safeTry(()=> master.gain.setValueAtTime(v, ctx.currentTime)); }
Â  Â  Â  function toggle(){ if(isPlaying){ stopBackground(); return false; } else { playBackground(); return true; } }
Â  Â  Â  return { init, playBackground, stopBackground, playClick, playChime, playCelebration, setVolume, toggle };
Â  Â  })();

Â  Â  // Start audio on first CTA click/gesture
Â  Â  let audioStarted = false;
Â  Â  function startAudioIfNeeded(){
Â  Â  Â  if(audioStarted) return;
Â  Â  Â  audioStarted = true;
Â  Â  Â  AudioManager.init();
Â  Â  Â  AudioManager.setVolume(parseFloat(document.getElementById('volRange').value || 0.65));
Â  Â  Â  AudioManager.playBackground();
Â  Â  Â  document.getElementById('audioBtn').textContent = 'ğŸ”Š';
Â  Â  }

Â  Â  // wire btn clicks to click sound (all .btn)
Â  Â  document.querySelectorAll('.btn').forEach(b => {
Â  Â  Â  b.addEventListener('click', ()=> {
Â  Â  Â  Â  startAudioIfNeeded();
Â  Â  Â  Â  AudioManager.playClick();
Â  Â  Â  });
Â  Â  });

Â  Â  // audio UI wiring
Â  Â  const audioBtn = document.getElementById('audioBtn');
Â  Â  audioBtn.addEventListener('click', async ()=>{
Â  Â  Â  AudioManager.init();
Â  Â  Â  await AudioManager.playClick();
Â  Â  Â  const on = AudioManager.toggle();
Â  Â  Â  audioBtn.textContent = on ? 'ğŸ”Š' : 'ğŸ”ˆ';
Â  Â  });
Â  Â  document.getElementById('volRange').addEventListener('input', e=> {
Â  Â  Â  AudioManager.setVolume(parseFloat(e.target.value));
Â  Â  });

Â  Â  // Ensure touchstart initializes audio context for iOS
Â  Â  document.addEventListener('touchstart', function firstTouch(){ AudioManager.init(); document.removeEventListener('touchstart', firstTouch); }, {passive:true});
Â  Â  document.addEventListener('click', function firstClick(){ AudioManager.init(); document.removeEventListener('click', firstClick); });

Â  Â  /***********************
Â  Â  Â * Final celebration wiring
Â  Â  Â ***********************/
Â  Â  const celebrateBtn = document.getElementById('celebrateBtn');
Â  Â  const finalWish = document.getElementById('finalWish');
Â  Â  celebrateBtn.addEventListener('click', ()=>{
Â  Â  Â  startAudioIfNeeded();
Â  Â  Â  AudioManager.playClick();
Â  Â  Â  celebrateBtn.disabled = true;
Â  Â  Â  gsap.to(celebrateBtn, {duration:0.4, opacity:0, scale:0.94, pointerEvents:'none', ease:'power2.inOut'});
Â  Â  Â  gsap.to(finalWish, {duration:0.9, opacity:1, y:0, ease:'power3.out', delay:0.35});
Â  Â  Â  AudioManager.playCelebration();
Â  Â  Â  launchConfettiSequence();
Â  Â  Â  heartsSwirlOut();
Â  Â  Â  gsap.to('.aurora', {duration:1.2, filter:'blur(28px) contrast(1.09) saturate(1.18)', ease:'power1.inOut', yoyo:true, repeat:1});
Â  Â  });

Â  Â  /***********************
Â  Â  Â * Initial page micro-animations & Navigation Fix
Â  Â  Â ***********************/
Â  Â  gsap.from('body', {duration:1.0, opacity:0, ease:'power2.out'});
Â  Â  gsap.to('#steps-root', {duration:8, y:-6, repeat:-1, yoyo:true, ease:'sine.inOut'});

Â  Â  // FIX: Animate Step 1 into view after page load, instead of re-running showStep(0)
Â  Â  const initialStep = document.getElementById('step-1');
Â  Â  gsap.from(initialStep, {duration:0.6, opacity:0, y:18, scale:0.99, ease:'power3.out', delay:0.2});

Â  Â  /***********************
Â  Â  Â * Ensure step positioning safety & Navigation
Â  Â  Â ***********************/
Â  Â  function safeShowStep(index){
Â  Â  Â  showStep(index);
Â  Â  Â  // fallback: if the newly activated element is out of view, scroll top (shouldn't happen but safety)
Â  Â  Â  setTimeout(()=>{
Â  Â  Â  Â  const active = document.querySelector('.card.step.active');
Â  Â  Â  Â  if(active){
Â  Â  Â  Â  Â  const rect = active.getBoundingClientRect();
Â  Â  Â  Â  Â  if(rect.top > window.innerHeight || rect.bottom < 0){
Â  Â  Â  Â  Â  Â  try{ window.scrollTo({ top: 0, behavior: 'smooth' }); }catch(e){}
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }, 300);
Â  Â  }

Â  Â  // Wire navigation buttons using the safe function
Â  Â  document.querySelectorAll('[data-next]').forEach(btn=>{
Â  Â  Â  btn.addEventListener('click', (ev)=>{
Â  Â  Â  Â  ev.preventDefault();
Â  Â  Â  Â  startAudioIfNeeded();
Â  Â  Â  Â  AudioManager.playClick();
Â  Â  Â  Â  setTimeout(()=> AudioManager.playChime(), 120);
Â  Â  Â  Â  safeShowStep(Math.min(currentStep + 1, totalSteps - 1));
Â  Â  Â  });
Â  Â  });

Â  Â  // Accessibility: roles, keyboard nav
Â  Â  window.addEventListener('keydown', (e)=>{
Â  Â  Â  if(e.key === 'ArrowRight') safeShowStep(Math.min(currentStep + 1, totalSteps - 1));
Â  Â  Â  if(e.key === 'ArrowLeft') safeShowStep(Math.max(currentStep - 1, 0));
Â  Â  });

Â  Â  /***********************
Â  Â  Â * Small accessibility / performance tweaks
Â  Â  Â ***********************/
Â  Â  // reduce heavy blur on low-end devices
Â  Â  try {
Â  Â  Â  const isLowPower = navigator.deviceMemory && navigator.deviceMemory < 2;
Â  Â  Â  if(isLowPower) document.querySelector('.aurora').style.filter = 'blur(24px) contrast(1.01)';
Â  Â  } catch(e){}

Â  </script>
</body>
</html>
