<div class="progress-bar-track w-1/3 max-w-sm h-2 rounded-full fixed top-5 left-1/2 -translate-x-1/2 z-50">
    <div id="progressBar" class="progress-bar-fill h-full rounded-full" style="width: 0%;"></div>
</div>

<main class="relative w-full max-w-2xl mx-auto h-[600px] flex items-center justify-center">

    <!-- Step 1: Welcome -->
    <div id="step-1" class="step card rounded-3xl p-8 md:p-12 text-center w-full">
        <div class="text-7xl mb-4 animate-pulse">‚ù§Ô∏è</div>
        <h1 class="text-gradient text-4xl md:text-5xl font-bold mb-4">Hey Beautiful,</h1>
        <p class="text-lg md:text-xl mb-8">I built a little world for you, just to bring a smile to your face on your special day.</p>
        <button class="button-glow text-white font-bold py-3 px-8 rounded-full text-lg">Let's Begin</button>
    </div>

    <!-- Step 2: Core Message -->
    <div id="step-2" class="step card rounded-3xl p-8 md:p-12 text-center w-full">
        <div class="text-7xl mb-4">üéâ</div>
        <h1 class="text-gradient text-4xl md:text-5xl font-bold mb-4">Happy Birthday!</h1>
        <p class="text-lg md:text-xl mb-8">Another year of you making the world brighter. Your existence is a gift, and I'm so lucky to witness it.</p>
        <button class="button-glow text-white font-bold py-3 px-8 rounded-full text-lg">There's more...</button>
    </div>

    <!-- Step 3: Bento Grid -->
    <div id="step-3" class="step card rounded-3xl p-8 md:p-12 w-full">
        <h1 class="text-gradient text-3xl md:text-4xl font-bold mb-6 text-center">A Few Things I Adore About You</h1>
        <div class="grid grid-cols-2 grid-rows-2 gap-4 text-left">
            <div class="bento-card rounded-2xl p-4 col-span-2">
                <h2 class="font-bold text-lg mb-1">‚ú® Your Unmatched Kindness</h2>
                <p class="text-sm text-gray-300">The genuine warmth you show to everyone is something truly rare and beautiful.</p>
            </div>
            <div class="bento-card rounded-2xl p-4">
                <h2 class="font-bold text-lg mb-1">üòä That Smile</h2>
                <p class="text-sm text-gray-300">It's a work of art.</p>
            </div>
            <div class="bento-card rounded-2xl p-4 col-span-2 md:col-span-1">
                <h2 class="font-bold text-lg mb-1">üåü Your Radiant Spirit</h2>
                <p class="text-sm text-gray-300">Your passion for life is infectious. Being around you makes everything feel more exciting and possible.</p>
            </div>
        </div>
        <div class="text-center mt-8">
            <button class="button-glow text-white font-bold py-3 px-8 rounded-full text-lg">Remember this?</button>
        </div>
    </div>

    <!-- Step 4: Shared Memory -->
    <div id="step-4" class="step card rounded-3xl p-8 md:p-12 text-center w-full">
        <h1 class="text-gradient text-4xl md:text-5xl font-bold mb-6">That One Time...</h1>
        <div class="flex justify-center mb-6">
            <div class="polaroid bg-white p-4 pb-12 rounded-lg shadow-xl w-64"
                style="transform: rotateZ(-5deg) rotateX(10deg);">
                <img src="https://i.ibb.co/6Z6XgCg/crush.webp" alt="A shared memory"
                    class="w-full h-auto object-cover">
                <p class="text-black text-center mt-3 text-lg" style="font-family: 'Playfair Display', serif;">Our favorite memory.</p>
            </div>
        </div>
        <p class="text-lg md:text-xl mb-8">Every moment with you feels like a scene from a movie I'd watch on repeat.</p>
        <button class="button-glow text-white font-bold py-3 px-8 rounded-full text-lg">One last thing...</button>
    </div>

    <!-- Step 5: Finale -->
    <div id="step-5" class="step card rounded-3xl p-8 md:p-12 text-center w-full">
        <div class="text-7xl mb-4">üéÇ</div>
        <h1 class="text-gradient text-4xl md:text-5xl font-bold mb-4">My Wish For You</h1>
        <p class="text-lg md:text-xl mb-6">May the next year bring you all the love, success, and pure happiness you so rightfully deserve. May your dreams soar higher than ever.</p>
        <div id="final-message-container" class="h-12">
            <p id="final-message" class="text-2xl text-pink-300 font-bold opacity-0"></p>
        </div>
        <button id="celebrate-btn" class="button-glow text-white font-bold py-3 px-8 rounded-full text-lg mt-2">Celebrate!</button>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- THREE.JS 3D HEARTS ---
        let scene, camera, renderer, hearts;
        const heartCount = 25;

        function initThree() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('bg-canvas'),
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);

            camera.position.z = 50;

            const heartShape = new THREE.Shape();
            heartShape.moveTo(25, 25);
            heartShape.bezierCurveTo(25, 25, 20, 0, 0, 0);
            heartShape.bezierCurveTo(-30, 0, -30, 35, -30, 35);
            heartShape.bezierCurveTo(-30, 55, -10, 77, 25, 95);
            heartShape.bezierCurveTo(60, 77, 80, 55, 80, 35);
            heartShape.bezierCurveTo(80, 35, 80, 0, 50, 0);
            heartShape.bezierCurveTo(35, 0, 25, 25, 25, 25);

            const extrudeSettings = {
                depth: 8,
                bevelEnabled: true,
                bevelSegments: 2,
                steps: 2,
                bevelSize: 1,
                bevelThickness: 1
            };
            const geometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);

            hearts = [];

            for (let i = 0; i < heartCount; i++) {
                const material = new THREE.MeshStandardMaterial({
                    color: new THREE.Color(`hsl(${330 + Math.random() * 30}, 100%, ${60 + Math.random() * 15}%)`),
                    metalness: 0.1,
                    roughness: 0.3
                });
                const heart = new THREE.Mesh(geometry, material);

                heart.position.set(
                    (Math.random() - 0.5) * 150,
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 50
                );
                heart.rotation.set(
                    Math.random() * Math.PI,
                    Math.random() * Math.PI,
                    Math.random() * Math.PI
                );
                const scale = Math.random() * 0.01 + 0.01;
                heart.scale.set(scale, scale, scale);

                // Add custom properties for animation
                heart.userData.sineOffset = Math.random() * Math.PI * 2;
                heart.userData.driftSpeed = Math.random() * 0.05 + 0.01;

                hearts.push(heart);
                scene.add(heart);
            }

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            hearts.forEach(heart => {
                heart.rotation.x += 0.001;
                heart.rotation.y += 0.002;
                heart.position.y += heart.userData.driftSpeed;
                heart.position.x += Math.sin(heart.position.y * 0.1 + heart.userData.sineOffset) * 0.1;

                if (heart.position.y > 60) {
                    heart.position.y = -60;
                    heart.position.x = (Math.random() - 0.5) * 150;
                }
            });

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.addEventListener('resize', onWindowResize, false);
        initThree();


        // --- POLAROID INTERACTION ---
        const polaroid = document.querySelector('.polaroid');
        if (polaroid) {
            polaroid.addEventListener('mousemove', (e) => {
                const rect = polaroid.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                const rotateX = -y / (rect.height / 2) * 10;
                const rotateY = x / (rect.width / 2) * 10;
                gsap.to(polaroid, {
                    rotationX: rotateX,
                    rotationY: rotateY,
                    rotationZ: -5,
                    scale: 1.05,
                    duration: 0.5,
                    ease: 'power2.out'
                });
            });

            polaroid.addEventListener('mouseleave', () => {
                gsap.to(polaroid, {
                    rotationX: 10,
                    rotationY: 0,
                    rotationZ: -5,
                    scale: 1,
                    duration: 0.5,
                    ease: 'power2.out'
                });
            });
        }

        // --- GSAP ANIMATIONS & STEP LOGIC ---
        const steps = document.querySelectorAll('.step');
        const buttons = document.querySelectorAll('button');
        const progressBar = document.getElementById('progressBar');
        let currentStep = 1;
        const totalSteps = 5;

        gsap.set(steps, {
            opacity: 0,
            visibility: 'hidden',
            y: 50,
            scale: 0.95
        });
        gsap.to('#step-1', {
            opacity: 1,
            visibility: 'visible',
            y: 0,
            scale: 1,
            duration: 1,
            ease: 'power3.out'
        });
        updateProgressBar();

        function updateProgressBar() {
            gsap.to(progressBar, {
                width: `${(currentStep - 1) / (totalSteps - 1) * 100}%`,
                duration: 0.8,
                ease: 'power2.inOut'
            });
        }

        function goToStep(nextStep) {
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            const nextStepElement = document.getElementById(`step-${nextStep}`);

            const tl = gsap.timeline({
                onComplete: () => {
                    currentStep = nextStep;
                    updateProgressBar();
                }
            });

            tl.to(currentStepElement, {
                    opacity: 0,
                    scale: 0.9,
                    duration: 0.5,
                    ease: 'power2.in'
                })
                .set(currentStepElement, {
                    visibility: 'hidden'
                })
                .set(nextStepElement, {
                    visibility: 'visible',
                    opacity: 0,
                    y: 50,
                    scale: 0.95
                })
                .to(nextStepElement, {
                    opacity: 1,
                    y: 0,
                    scale: 1,
                    duration: 0.8,
                    ease: 'power3.out'
                });
        }

        buttons.forEach(button => {
            button.addEventListener('click', () => {
                if (currentStep < totalSteps) {
                    goToStep(currentStep + 1);
                }
            });
        });

        // --- FINALE SEQUENCE ---
        const celebrateBtn = document.getElementById('celebrate-btn');
        celebrateBtn.addEventListener('click', () => {
            const finalMessage = document.getElementById('final-message');
            finalMessage.textContent = "Happy Birthday, my crush! ‚ù§Ô∏è";

            const tlFinale = gsap.timeline();
            tlFinale.to(celebrateBtn, {
                    opacity: 0,
                    scale: 0.8,
                    duration: 0.5,
                    ease: 'power2.in',
                    onComplete: () => celebrateBtn.style.display = 'none'
                })
                .to(finalMessage, {
                    opacity: 1,
                    y: -10,
                    duration: 1,
                    ease: 'elastic.out(1, 0.5)'
                }, "-=0.2");

            // Confetti
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = {
                startVelocity: 30,
                spread: 360,
                ticks: 60,
                zIndex: 0
            };

            function randomInRange(min, max) {
                return Math.random() * (max - min) + min;
            }

            const interval = setInterval(function () {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) {
                    return clearInterval(interval);
                }
                const particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: {
                        x: randomInRange(0.1, 0.3),
                        y: Math.random() - 0.2
                    },
                    shapes: ['circle', 'square'],
                    colors: ['#ec4899', '#ef4444', '#f59e0b', '#8b5cf6']
                }));
                confetti(Object.assign({}, defaults, {
                    particleCount,
                    origin: {
                        x: randomInRange(0.7, 0.9),
                        y: Math.random() - 0.2
                    },
                    shapes: ['circle', 'square'],
                    colors: ['#ec4899', '#ef4444', '#f59e0b', '#8b5cf6']
                }));
                confetti({
                    particleCount: 2,
                    angle: 90,
                    spread: 180,
                    origin: {
                        y: 0.5
                    },
                    shapes: ['emoji'],
                    shapeOptions: {
                        emoji: {
                            value: ['‚ù§Ô∏è', 'üíñ', '‚ú®']
                        }
                    }
                });
            }, 250);

            // 3D Hearts finale
            hearts.forEach(heart => {
                gsap.to(heart.position, {
                    x: heart.position.x * 3,
                    y: heart.position.y + 100,
                    z: heart.position.z + (Math.random() - 0.5) * 100,
                    duration: 4,
                    ease: 'power2.inOut'
                });
                gsap.to(heart.material, {
                    opacity: 0,
                    duration: 4,
                    ease: 'power2.in'
                });
            });
        });
    });
</script>
